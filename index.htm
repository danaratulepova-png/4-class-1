<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–í–∏–¥–µ–æ –≤ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏</title>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
body{
  font-family: 'Comic Sans MS', cursive;
  background: linear-gradient(135deg,#74ebd5,#acb6e5);
  padding:20px;
}

.container{
  background:white;
  padding:25px;
  border-radius:20px;
  max-width:750px;
  margin:auto;
  box-shadow:0 10px 25px rgba(0,0,0,0.2);
}

h2{ text-align:center; color:#4a4a4a; }

button{
  background:#ff7eb3;
  border:none;
  padding:10px 20px;
  border-radius:15px;
  color:white;
  font-size:16px;
  cursor:pointer;
  transition:0.3s;
}
button:hover{ background:#ff4f91; transform:scale(1.05); }

input{
  padding:8px;
  border-radius:10px;
  border:1px solid #ccc;
}

.hidden{ display:none; }

.question{
  background:#f9f9ff;
  padding:15px;
  border-radius:15px;
  margin-bottom:15px;
}

img.icon{
  width:60px;
  display:block;
  margin-bottom:10px;
}

.admin{
  background:#fff3cd;
  padding:15px;
  border-radius:15px;
  margin-top:20px;
}
</style>
</head>

<body>

<div class="container">

<h2>üé¨ –í–∏–¥–µ–æ –≤ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏</h2>

<div id="registration">
<h3>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
<input type="text" id="name" placeholder="–ò–º—è"><br><br>
<input type="text" id="class" placeholder="–ö–ª–∞—Å—Å"><br><br>
<button onclick="startTest()">–ù–∞—á–∞—Ç—å</button>
</div>

<div id="quiz" class="hidden">

<div class="question">
<h3>1Ô∏è‚É£ –í—ã–±–µ—Ä–∏ —à–∞–≥–∏ –≤—Å—Ç–∞–≤–∫–∏ –≤–∏–¥–µ–æ</h3>
<img class="icon" src="https://img.icons8.com/color/96/video.png">
<input type="checkbox" value="1"> –û—Ç–∫—Ä—ã—Ç—å –Ω—É–∂–Ω—ã–π —Å–ª–∞–π–¥<br>
<input type="checkbox" value="1"> –ù–∞–∂–∞—Ç—å ¬´–í—Å—Ç–∞–≤–∫–∞¬ª<br>
<input type="checkbox" value="1"> –í—ã–±—Ä–∞—Ç—å ¬´–í–∏–¥–µ–æ¬ª<br>
<input type="checkbox" value="0"> –í—Å—Ç–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É<br>
</div>

<div class="question">
<h3>2Ô∏è‚É£ –ß—Ç–æ –Ω–∞–∂–∞—Ç—å –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–µ–æ?</h3>
<img class="icon" src="https://img.icons8.com/color/96/add.png">
<input type="radio" name="q2" value="0"> –ì–ª–∞–≤–Ω–∞—è<br>
<input type="radio" name="q2" value="2"> –í—Å—Ç–∞–≤–∫–∞ ‚Üí –í–∏–¥–µ–æ<br>
<input type="radio" name="q2" value="0"> –î–∏–∑–∞–π–Ω<br>
</div>

<div class="question">
<h3>3Ô∏è‚É£ –ß—Ç–æ–±—ã –≤–∏–¥–µ–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–ª–æ—Å—å?</h3>
<img class="icon" src="https://img.icons8.com/color/96/play.png">
<input type="radio" name="q3" value="2"> –í—Å—Ç–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ —Ñ–∞–π–ª<br>
<input type="radio" name="q3" value="0"> –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É<br>
<input type="radio" name="q3" value="0"> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ<br>
</div>

<div class="question">
<h3>4Ô∏è‚É£ –ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –∑–Ω–∞—á–æ–∫ ‚ñ∂ ?</h3>
<img class="icon" src="https://img.icons8.com/color/96/circled-play.png">
<input type="radio" name="q4" value="2"> –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –≤–∏–¥–µ–æ<br>
<input type="radio" name="q4" value="0"> –£–¥–∞–ª–∏—Ç—å –≤–∏–¥–µ–æ<br>
</div>

<button onclick="submitTest()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
</div>

<div id="result"></div>

<hr>

<h3>üîê –í—Ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
<input type="password" id="adminPass" placeholder="–ü–∞—Ä–æ–ª—å">
<button onclick="showAdmin()">–í–æ–π—Ç–∏</button>

<div id="adminPanel" class="admin hidden">
<h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h3>

<select id="filterClass" onchange="loadResults()">
<option value="all">–í—Å–µ –∫–ª–∞—Å—Å—ã</option>
</select>

<div id="resultsList"></div>

<br>
<button onclick="exportExcel()">üì• –°–∫–∞—á–∞—Ç—å Excel</button>
</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "–í–ê–®_API_KEY",
  authDomain: "–í–ê–®_AUTH_DOMAIN",
  projectId: "–í–ê–®_PROJECT_ID",
  storageBucket: "–í–ê–®_STORAGE",
  messagingSenderId: "–í–ê–®_SENDER",
  appId: "–í–ê–®_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let allResults = [];

window.startTest = function(){
  document.getElementById("registration").classList.add("hidden");
  document.getElementById("quiz").classList.remove("hidden");
}

window.submitTest = async function(){

  let score = 0;

  let checks = document.querySelectorAll("input[type=checkbox]:checked");
  checks.forEach(c => score += parseInt(c.value));
  score = (score === 3) ? 2 : 0;

  score += parseInt(document.querySelector("input[name=q2]:checked")?.value || 0);
  score += parseInt(document.querySelector("input[name=q3]:checked")?.value || 0);
  score += parseInt(document.querySelector("input[name=q4]:checked")?.value || 0);

  let student = {
    name: document.getElementById("name").value,
    class: document.getElementById("class").value,
    score: score,
    date: new Date().toLocaleString()
  };

  await addDoc(collection(db,"results"), student);

  document.getElementById("quiz").classList.add("hidden");
  document.getElementById("result").innerHTML =
    `<h3>üéâ –¢–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${score} –∏–∑ 8 –±–∞–ª–ª–æ–≤</h3>`;
}

window.showAdmin = function(){
  if(document.getElementById("adminPass").value === "admin123"){
    document.getElementById("adminPanel").classList.remove("hidden");
    loadResults();
  } else alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å");
}

async function loadResults(){
  const snapshot = await getDocs(collection(db,"results"));
  let list="";
  let classes=new Set();
  allResults=[];

  snapshot.forEach(doc=>{
    let data=doc.data();
    allResults.push(data);
    classes.add(data.class);

    if(document.getElementById("filterClass").value==="all" ||
       document.getElementById("filterClass").value===data.class){

      list+=`<p><b>${data.name}</b> (${data.class}) ‚Äî ${data.score} –±–∞–ª–ª–æ–≤</p>`;
    }
  });

  document.getElementById("resultsList").innerHTML=list;

  let select=document.getElementById("filterClass");
  select.innerHTML='<option value="all">–í—Å–µ –∫–ª–∞—Å—Å—ã</option>';
  classes.forEach(c=>{
    select.innerHTML+=`<option value="${c}">${c}</option>`;
  });
}

window.exportExcel=function(){
  let worksheet = XLSX.utils.json_to_sheet(allResults);
  let workbook = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(workbook, worksheet, "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã");
  XLSX.writeFile(workbook, "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã_—É—á–µ–Ω–∏–∫–æ–≤.xlsx");
}

</script>

</body>
</html>